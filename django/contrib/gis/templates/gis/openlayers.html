{% load i18n l10n static %}

{% comment %}
    The following "div" is actually a disguised "style". We can't use "style"
    here because the HTML standard doesn't allow it; so we put the style in an
    undisplayed "div", and we have some JavaScript grab its contents and insert
    them into a dynamically created "style" element. (It might have been more
    elegant to include these contents in the JavaScript instead of in a fake
    div, but there's currently no cross-browser support for JavaScript
    multiline strings.)
{% endcomment %}

<div id="map_css" style="display: none">{% block map_css %}{% get_current_language_bidi as LANGUAGE_BIDI %}
    #{{ id }}_map { width: {{ map_width }}px; height: {{ map_height }}px; }
    #{{ id }}_map .aligned label { float: inherit; }
    #{{ id }}_div_map { position: relative; vertical-align: top; float: {{ LANGUAGE_BIDI|yesno:"right,left" }}; }
    {% if not display_raw %}#{{ id }} { display: none; }{% endif %}
    .olControlEditingToolbar .olControlModifyFeatureItemActive {
        background-image: url("{% static "admin/img/gis/move_vertex_on.svg" %}");
        background-repeat: no-repeat;
    }
    .olControlEditingToolbar .olControlModifyFeatureItemInactive {
        background-image: url("{% static "admin/img/gis/move_vertex_off.svg" %}");
        background-repeat: no-repeat;
    }{% endblock %}
</div>

<div id="{{ id }}_div_map">
    <div id="{{ id }}_map"></div>
    <span class="clear_features"><a href="javascript:{{ module }}.clearFeatures()">{% trans "Delete all Features" %}</a></span>
    {% if display_raw %}<p>{% trans "Debugging window (serialized value)" %}</p>{% endif %}
    <textarea id="{{ id }}" class="vSerializedField required" cols="150" rows="10" name="{{ name }}">{{ serialized }}</textarea>
    <script type="text/javascript">
        {% block map_options %}var map_options = {};{% endblock %}
        {% block options %}var options = {
            geom_name: '{{ geom_type }}',
            id: '{{ id }}',
            map_id: '{{ id }}_map',
            map_options: map_options,
            map_srid: {{ map_srid|unlocalize }},
            name: '{{ name }}'
        };
        {% endblock %}

        // Create the style for the widget
        var map_css = document.getElementById('map_css').innerHTML;
        var style_element = document.createElement('style');
        style_element.type = 'text/css';
        if(style_element.styleSheet) {
            style_element.styleSheet.cssText = map_css;
        } else {
            style_element.appendChild(document.createTextNode(map_css));
        }
        document.getElementsByTagName('head')[0].appendChild(style_element);

        var {{ module }} = new MapWidget(options);
    </script>
</div>
